## ADR-099: Микросервис "Тотализатор" (секретный)

### Статус ADR: Proposed

### Контекст

В данном разделе фиксируются требования и консерны стейкхолдеров, а также дополнительные размышления по поводу ограничения.

**Требования:**
- **[US-250]** Для решения проблемы низкой мотивации менеджеров MCF была разработана система ставок. Эта система позволяет менеджерам делать ставки на результат выполнения каждого заказа. Мы надеемся, что это поможет привлечь больше сотрудников в компанию. Ставки могут делать только менеджеры, численность которых не должна превышать 15 человек. Мы не ожидаем большого количества ставок из-за ограниченного числа заказов.
- **[US-251]** Мы доверяем менеджерам, поэтому они сами распределяют деньги между собой в случае проигрыша или выигрыша. Если все проигрывают, банк переходит к разработчикам.
- **[US-260]** Вся логика ставок заключается в том, что менеджеры ставят сумму на заказ и условие. После выполнения, отмены или провала заказа система автоматически рассчитывает, кому и сколько денег нужно отдать (банк делится между победителями). Этот проект не является критически важным для компании, поэтому он вряд ли будет часто меняться.
- **[US-261]** Условия включают "простую" логику, такую как "заказ выполнен/провален". Здесь нет составных условий, и никто не хочет добавлять что-то новое в код.
- **[US-262]** Компания не хочет отчитываться перед налоговыми органами за незаконный тотализатор. Поэтому все финансовые операции ведутся в "серой зоне" и фиксируются только в бумажной тетради старшего менеджера.

**Консерны:**
- Менеджеры хотят, чтобы о системе ставок не знали другие отделы, чтобы избежать нежелательных ситуаций. Они хотят скрыть эту систему даже от разработчиков, которые не будут работать над ней, и от руководства.

**Дополнительные ограничения:**
- Ограничение по условиям ставок (простая логика "выполнен/провален заказ") минимизирует сложность системы и снижает необходимость внесения изменений в код, что особенно важно для проекта с низким приоритетом.

### Решение
Создать отдельный микросервис, скрытый от разработчиков, не участвующих в его разработке. Для коммуникации между сервисами выбрать асинхронные стриминговые события, чтобы избежать явных вызовов из сервиса управления заказами, что позволит скрыть существование микросервиса и избежать подозрений со стороны других разработчиков. Такой подход также способствует достижению decoupling между сервисами. В качестве базы данных выбрать реляционную СУБД, поскольку для расчета результатов ставок важна транзакционность и консистентность данных.